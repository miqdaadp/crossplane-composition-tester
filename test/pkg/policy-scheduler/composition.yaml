inline:
  template: |-
    {{- $currentTime := now | date "2006-01-02T15:04:05Z" }}
    {{- range .observed.composite.spec.schedules }}
      {{- $scheduleFrom := .scheduleFrom | date "2006-01-02T15:04:05Z" }}
      {{- $scheduleUntil := .scheduleUntil | date "2006-01-02T15:04:05Z" }}
      
      {{- if and (ge $currentTime $scheduleFrom) (le $currentTime $scheduleUntil) }}
      ---
      apiVersion: iam.aws.crossplane.io/v1beta1
      kind: Role
      metadata:
        name: {{ .roleName }}
      spec:
        forProvider:
          assumeRolePolicyDocument: |
            {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Principal": {
                    "Service": "ec2.amazonaws.com"
                  },
                  "Action": "sts:AssumeRole"
                }
              ]
            }
        providerConfigRef:
          name: aws-provider
      ---
      apiVersion: iam.aws.crossplane.io/v1beta1
      kind: Policy
      metadata:
        name: {{ .policyArn | base | split ":" | last }}
      spec:
        forProvider:
          document: |
            {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": "s3:ListBucket",
                  "Resource": "*"
                }
              ]
            }
        providerConfigRef:
          name: aws-provider
      ---
      apiVersion: iam.aws.crossplane.io/v1beta1
      kind: RolePolicyAttachment
      metadata:
        name: {{ .roleName }}-policy-attachment
      spec:
        forProvider:
          policyArnRef:
            name: {{ .policyArn }}
          roleNameRef:
            name: {{ .roleName }}
        providerConfigRef:
          name: aws-provider
      {{- end }}
    {{- end }}